
⚡Race conditions occur when two or more processes or threads access and manipulate a shared resource concurrently, leading to unexpected or insecure behavior.
## 🔍 Detection

### Behaviors to Watch For

- Repeated requests causing **multiple executions** of an action meant to be performed **once**.
- Inconsistent responses from rapid successive requests.
- Logs showing repeated application of sensitive actions (e.g., multiple coupon redemptions)
- Manual or automated tests exploring **Time-of-Check to Time-of-Use (TOCTOU)** timing windows.
### 📌Key Indicators

- Sensitive action parameters such as `transfer`, `apply_coupon`, `vote`, `redeem`.
- Observing intermediate states before final confirmation (e.g., “pending” → “approved”).

---
## 🧪 Testing with Burp Suite

### 🛠️ Setup

1. Capture the sensitive request (e.g., POST to transfer funds).
2. Send it to the Repeater tab.
3. Duplicate the request multiple times (e.g., 20 copies).
4. Use Burp’s **Send group** feature with different modes.    
### 🎯 Send Group Modes

| Mode                                          | Description                                      | Use Case                        |
| --------------------------------------------- | ------------------------------------------------ | ------------------------------- |
| Send group in sequence (single connection)    | Sends requests one-by-one on same TCP connection | Basic testing                   |
| Send group in sequence (separate connections) | Sends requests one-by-one on new TCP connections | Simpler concurrency             |
| **Send group in parallel**                    | Sends all requests simultaneously in parallel    | Best for race condition testing |

> For race condition exploitation, **Send group in parallel** is ideal.

>**Technical Notes on Parallel Sending Mode**
> - HTTP/1 uses **last-byte synchronization**: sends all requests except last byte, then last bytes together.
> - HTTP/2 sends all requests in a **single TCP packet**, facilitating concurrency.    

---
## 🛡️ Mitigation Strategies

### 🔒 Synchronization
- Use **locks (mutexes)** to allow only one process/thread to access the resource at a time.
- Use **semaphores** to limit concurrent accesses.

### ⚙️ Atomic Operations
- Ensure critical operations are indivisible.
- Prevent reading/modifying shared data simultaneously.

### 💾 Database Transactions
- Use transactions with appropriate **isolation levels**.
- Combine checks and updates in the **same transaction**.

### 🚦 Flags and Limits
- Use **binary flags** to mark actions as completed.
- Implement **rate limiting** to prevent rapid repeated access.

### 🧹 Server-side Validation
- Never trust client-side state.
- Always revalidate business logic on the server before committing changes.

---

## General Tips

- Map internal application states.
- Identify vulnerable timing windows.
- Combine Burp Suite, Intruder, or custom scripts (Python, curl + xargs) for testing.
- Focus on one-time actions, conditional validations, and financial transactions.

---